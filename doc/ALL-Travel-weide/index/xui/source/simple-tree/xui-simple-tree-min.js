xui.widgets.SimpleTreeNode=function(a){this.attributes=a;if(typeof a=="string"){this.attributes={text:a}}this.text=this.attributes.text;this.leaf=this.attributes.leaf;this.id=this.attributes.id;this.iconCls="";if(this.attributes.iconCls){this.iconCls=this.attributes.iconCls}this.childNodesHash={};this.parentNode=null;this.isSelected=false;this.dataUrl;this.ownerTree;var b=this;var c=this.id;xui.util.Event.on(c,"click",function(){b.clickNode()})};xui.widgets.SimpleTreeNode.prototype={_hasClass:function(b,a){return a&&(" "+b.className+" ").indexOf(" "+a+" ")!=-1},_addDomClass:function(b,a){if(a&&!this._hasClass(b,a)){b.className=b.className+" "+a}},_removeDomClass:function(b,a){if(a&&this._hasClass(b,a)){b.className=b.className.replace(a," ")}},setStyle:function(a){var b=document.getElementById(this.id);this._addDomClass(b.childNodes[2],a)},removeStyle:function(a){var b=document.getElementById(this.id);this._removeDomClass(b.childNodes[2],a)},_getData:function(p){var dataUrl=this.getOwnerTree().dataUrl;if(dataUrl.indexOf("?")>-1){dataUrl+="&node="+this.id}else{dataUrl+="?node="+this.id}var s=xui.util.Ajax.syncGet(dataUrl);var cn=eval("("+s+")");var n=[];if(cn){var l=cn.length;for(var i=0;i<l;i++){n[i]=new xui.widgets.SimpleTreeNode(cn[i])}}return n},setText:function(a){this.text=a;xui.util.Dom.getElementsByClassName("xui-simpleTree-node-text","span",this.nodeDom)[0].innerHTML=xui.util.StringUtil.htmlEncode(a)},getOwnerTree:function(){if(!this.ownerTree){var a=this;while(a){if(a.ownerTree){this.ownerTree=a.ownerTree;break}a=a.parentNode}}return this.ownerTree},render:function(){var a=this._getData();this._setChildNodes(a);this._renderChildren();this.hasExpanded=true},_registerNode:function(a){this.childNodesHash[a.id]=a},_unregisterNode:function(a){delete this.childNodesHash[a.id]},_setChildNodes:function(b){for(var a=0;a<b.length;a++){this._registerNode(b[a])}},_renderChildren:function(){var b=this;var c=document.getElementById(this.id);var a=[];for(key in this.childNodesHash){this.childNodesHash[key].parentNode=this;this.getOwnerTree()._registerNode(this.childNodesHash[key]);c.nextSibling.appendChild(this.childNodesHash[key].setNodeDom())}},getChildNodeById:function(a){return this.childNodesHash[a]},appendChild:function(c){var e=this;c.parentNode=e;c.parentNode.leaf=false;c.parentNode._registerNode(c);var f=document.getElementById(this.id);var d=c.setNodeDom();this.getOwnerTree()._registerNode(c);var b=xui.util.Dom.getNextSibling(f);var a=xui.util.Dom.getFirstChild(b);if(a){xui.util.Dom.insertBefore(d,a)}else{if(this.hasExpanded){b.appendChild(d)}}this.setLeafStyle()},remove:function(){this.getOwnerTree()._unregisterNode(this);this.parentNode.removeChild(this)},removeChild:function(a){this.getOwnerTree().getSelectionModel().unselect(a);a.parentNode._unregisterNode(a);a.parentNode.setLeafStyle();if(!this.hasChildren()){a.parentNode.leaf=true}var b=a.getNodeDom();if(b){b.parentNode.removeChild(b)}},clickNode:function(){var a=document.getElementById(this.id);this.select();if(!this.leaf){if(a.nextSibling.style.display=="none"){this.expand()}else{this.collapse()}}},insertBefore:function(a,b){},collapse:function(){var a=document.getElementById(this.id);a.nextSibling.style.display="none";this._removeDomClass(a,"xui-simpleTree-node-expanded");this._addDomClass(a,"xui-simpleTree-node-collapsed");this._removeDomClass(a.childNodes[1],"xui-simpleTree-elbow-end-minus");this._addDomClass(a.childNodes[1],"xui-simpleTree-elbow-end-plus")},collapseChildNodes:function(){},expand:function(){var a=document.getElementById(this.id);a.nextSibling.style.display="";this._removeDomClass(a,"xui-simpleTree-node-collapsed");this._addDomClass(a,"xui-simpleTree-node-expanded");this._removeDomClass(a.childNodes[1],"xui-simpleTree-elbow-end-plus");this._addDomClass(a.childNodes[1],"xui-simpleTree-elbow-end-minus");if(!this.hasExpanded){this.render()}},expandChildNodes:function(){},leaf:function(){return this.leaf},hasChildren:function(){var a=0;for(key in this.childNodesHash){a++}return(a>0)?true:false},setLeafStyle:function(){var b=xui.util.Dom.getElementsByClassName("xui-simpleTree-node-el","div",this.nodeDom)[0];var a=xui.util.Dom.getElementsByClassName("xui-simpleTree-ec-icon","img",this.nodeDom)[0];if(!this.hasChildren()){this._removeDomClass(b,"xui-simpleTree-node-collapsed");this._removeDomClass(b,"xui-simpleTree-node-expanded");this._addDomClass(b,"xui-simpleTree-node-leaf");this._removeDomClass(a,"xui-simpleTree-elbow-end-plus");this._removeDomClass(a,"xui-simpleTree-elbow-end-minus");this._addDomClass(a,"xui-simpleTree-elbow")}else{this._removeDomClass(b,"xui-simpleTree-node-leaf");this._addDomClass(b,"xui-simpleTree-node-collapsed");this._removeDomClass(a,"xui-simpleTree-elbow");this._addDomClass(a,"xui-simpleTree-end-minus")}},select:function(){this.getOwnerTree().getSelectionModel().select(this);this.isSelected=true},unselect:function(){this.getOwnerTree().getSelectionModel().unselect(this);this.isSelected=false},uiSelect:function(){var a=document.getElementById(this.id);this._addDomClass(a,"xui-simpleTree-selected")},uiUnSelect:function(){var a=document.getElementById(this.id);this._removeDomClass(a,"xui-simpleTree-selected")},getDepth:function(){var b=0;var a=this;while(a.parentNode){++b;a=a.parentNode}return b},getNodeDom:function(){return this.nodeDom},setNodeDom:function(){var f='<IMG class=xui-simpleTree-icon src="'+xui.BLANK_IMAGE_URL+'"  aliNodeId='+this.id+">";var d='<IMG class=xui-simpleTree-elbow-line src="'+xui.BLANK_IMAGE_URL+'"  aliNodeId='+this.id+">";this.nodeDom=document.createElement("li");xui.util.Dom.addClass(this.nodeDom,"xui-simpleTree-node");var c=[];c[0]="";if(this.leaf){c[1]="<DIV id="+this.id+" aliNodeId="+this.id+' class="xui-simpleTree-node-el  xui-simpleTree-unselectable xui-simpleTree-node-leaf"  unselectable="on">'}else{c[1]="<DIV id="+this.id+" aliNodeId="+this.id+' class="xui-simpleTree-node-el  xui-simpleTree-unselectable xui-simpleTree-node-collapsed"  unselectable="on">'}c[2]="<SPAN class=xui-simpleTree-node-indent aliNodeId="+this.id+">";var e=this.getDepth();c[3]="";if(e){if(e==1){c[3]=f}else{for(var b=0;b<(e-1);b++){c[3]=c[3]+f}c[3]=c[3]+d}}else{c[3]=""}c[4]="</SPAN>";if(this.leaf){c[5]="<IMG aliNodeId="+this.id+' class="xui-simpleTree-ec-icon xui-simpleTree-elbow" src="'+xui.BLANK_IMAGE_URL+'">'}else{c[5]="<IMG aliNodeId="+this.id+' class="xui-simpleTree-ec-icon xui-simpleTree-elbow-end-plus" src="'+xui.BLANK_IMAGE_URL+'">'}c[6]="<IMG aliNodeId="+this.id+' class="xui-simpleTree-node-icon '+this.iconCls+'" src="'+xui.BLANK_IMAGE_URL+'" unselectable="on">';if(this.getOwnerTree().renderer){var a=this.getOwnerTree().renderer(this.id,this.text);c[7]="<A aliNodeId="+this.id+' class=xui-simpleTree-node-anchor hideFocus tabIndex=1><SPAN class="xui-simpleTree-node-text" aliNodeId='+this.id+' unselectable="on">'+a+"</SPAN></A>"}else{c[7]="<A aliNodeId="+this.id+' class=xui-simpleTree-node-anchor hideFocus tabIndex=1><SPAN class="xui-simpleTree-node-text" aliNodeId='+this.id+' unselectable="on">'+this.text+"</SPAN></A>"}c[8]="</DIV>";c[9]='<UL class=xui-simpleTree-node-ct  style="display:none">';c[10]="</UL>";c[11]="</LI>";this.nodeDom.innerHTML=c.join("");return this.nodeDom},getAttributesByKey:function(key){var v=eval("this.attributes."+key+"");if(v){return v}}};xui.widgets.SimpleTree=function(b,a){if(a){this.attributes=a;if(this.attributes.dataUrl){this.dataUrl=this.attributes.dataUrl}if(this.attributes.leafStyle){this.leafStyle=this.attributes.leafStyle}if(this.attributes.nonLeafOpenStyle){this.nonLeafOpenStyle=this.attributes.nonLeafOpenStyle}if(this.attributes.nonLeafCloStyleClo){this.nonLeafCloStyleClo=this.attributes.nonLeafCloStyleClo}}this.root;this.id=b;this.container=$(b);this.dataSource;this.selModel;this.nodeHash={};this._events={}};xui.widgets.SimpleTree.prototype={setRootNode:function(a){this.root=a;a.ownerTree=this;this._registerNode(a)},getRootNode:function(){return this.root},setLeafStyle:function(a){this.leafStyle=a},getSelectedNode:function(){return this.getSelectionModel().getSelectedNode()},getSelectionModel:function(){if(!this.selModel){this.selModel=new xui.widgets.SimpleTreeSelectionModel()}return this.selModel},_getContainerWidth:function(){if(this.container.style.width){return this.container.style.width}else{var a=this.container.currentStyle?this.container.currentStyle:document.defaultView.getComputedStyle(this.container,null);if(a.width){return a.width}else{return""}}},_getContainerHeight:function(){if(this.container.style.height){return this.container.style.height}else{var a=this.container.currentStyle?this.container.currentStyle:document.defaultView.getComputedStyle(this.container,null);if(a.height){return a.height}else{return""}}},_renderHeader:function(){var a=[];a[0]="<DIV class=x-panel-bwrap>";a[1]='<DIV class="xui-panel-body xui-panel-body-noheader"  style="OVERFLOW: auto;WIDTH: '+this._getContainerWidth()+"; HEIGHT:"+this._getContainerHeight()+'; ">';a[2]='<UL class="xui-simpleTree-root-ct xui-simpleTree-lines">';a[3]='<DIV class=xui-simpleTree-root-node id="ali-root-node">';a[4]="</DIV>";a[5]="</UL>";a[6]="</DIV>";a[7]="</DIV>";this.container.innerHTML=a.join("")},init:function(a,b,c){this.renderer=c;this._initEnvents("click");this._initEnvents("dblclick");var e=this;xui.util.Event.on(this.container,"click",function(){e._fire("click",e.selModel.getSelectedNode())});xui.util.Event.on(this.container,"dblclick",function(){e._fire("dblclick",e.selModel.getSelectedNode())});this._initEnvents();this.dataUrl=a;this._renderHeader();this.root=new xui.widgets.SimpleTreeNode({text:b,leaf:false,id:"-1"});this.setRootNode(this.root);var d=this.root.setNodeDom();xui.util.Dom.getElementsByClassName("xui-simpleTree-root-node","div",this.id)[0].appendChild(d);this.root.expand();var f=xui.util.Dom.getElementsByClassName("xui-simpleTree-ec-icon","img",this.id)[0];xui.util.Dom.addClass(f,"xui-simpleTree-ec-icon-root");this.getSelectionModel().init(this)},_registerNode:function(a){this.nodeHash[a.id]=a},_unregisterNode:function(a){delete this.nodeHash[a.id]},getNodeById:function(a){return this.nodeHash[a]},on:function(a,b){this._events[a].subscribe(b,this)},_initEnvents:function(a){this._events[a]=new YAHOO.util.CustomEvent(a,this)},_fire:function(b,a){this._events[b].fire(a)}};xui.widgets.SimpleTreeSelectionModel=function(){this.selNode};xui.widgets.SimpleTreeSelectionModel.prototype={init:function(a){this.tree=a},select:function(b){var a=this.selNode;if(a!=b){if(a){a.uiUnSelect()}b.uiSelect();this.selNode=b}return b},unselect:function(a){if(this.selNode==a){this.clearSelections()}},clearSelections:function(){var a=this.selNode;if(a){a.uiUnSelect();this.selNode=null}return a},getSelectedNode:function(){return this.selNode}};
