xui.widgets.Select=function(c,b,a){this.id="xui-select-"+c;this.obj=[];this.width=b;if(a){this.model=true}else{this.model=false}this.init(c,b,a)};xui.widgets.Select.prototype={isclose:false,model:false,init:function(b){this.porobj=$(b);var r=xui.util.Dom.getX(b);var q=xui.util.Dom.getY(b);var s=this.width;this.porobj.style.display="none";var a="";if(this.model){a+='<span class="xui-select-value" id="'+this.id+'-value"></span>'}else{a+='<input class="xui-select-value" readonly="readonly" id="'+this.id+'-value"/>'}a+='<span class="xui-select-btn" id="'+this.id+'-btn"></span>';var c=document.createElement("div");c.className="xui-select";c.id=this.id;c.style.width=s+"px";c.innerHTML=a;this.porobj.parentNode.insertBefore(c,this.porobj);this.opsnode=document.createElement("div");this.opsnode.id=this.id+"-option";this.opsnode.className="xui-select-option";this.opsnode.style.width=s+"px";this.opsnode.style.zIndex=9999;document.body.appendChild(this.opsnode);this.node=$(this.id);this.porobj=$(b);this.shownode=$(this.id+"-value");var p=0;try{p+=parseInt(xui.util.Dom.getStyle(xui.util.Dom.get(this.id+"-btn"),"margin-left"));p+=parseInt(xui.util.Dom.getStyle(xui.util.Dom.get(this.id+"-btn"),"margin-right"));p+=parseInt(xui.util.Dom.getStyle(xui.util.Dom.get(this.id+"-value"),"margin-left"));p+=parseInt(xui.util.Dom.getStyle(xui.util.Dom.get(this.id+"-value"),"margin-right"))}catch(o){}var d=parseInt(xui.util.Dom.getStyle($(this.id+"-btn"),"width"))+(isNaN(p)?0:p);this.shownode.style.width=s-d-3+"px";this.button=$(this.id+"-btn");this.opsnode.style.width=s+"px";this.opsnode.style.left=r+"px";var l=this.node.offsetHeight;this.opsnode.style.top=(q+l)+"px";this.opsnode.style.position="absolute";var j=this.opsnode.offetHeight;if(this.porobj.options){for(var g=0;g<this.porobj.options.length;g++){if(this.porobj.options[g].selected){this.index=g}this._inertChild(this.porobj.options[g])}this.value(this.porobj.options[this.index])}else{if(this.porobj.childNodes){var n=this.porobj.childNodes.length;for(var g=0;g<n;g++){if(this.porobj.childNodes[g].typeNode!=1){var t=this.porobj.childNodes[g].innerHTML.replace(/<.*?>/ig,"");this._inertChild({text:t,value:t})}}this.index=0;if(n>0){this.value(this.obj[0].o)}}}this.opsnode.style.display="none";(function(e){xui.util.Event.on([e.button,e.shownode],"click",function(){if(!e.click()){return}var f=xui.util.Dom.getX(e.id),z=xui.util.Dom.getY(e.id)+e.node.offsetHeight;if(xui.env.ua.gecko>0){f+=1}e.opsnode.style.left=f+"px";e.opsnode.style.top=z+"px";if(e.opsnode.style.display=="block"){e.opsnode.style.display="none";return}e.opsnode.style.display="block";if(xui.widgets.SelectUUopsnode!=e.opsnode){if(xui.widgets.SelectUUopsnode.style){xui.widgets.SelectUUopsnode.style.display="none"}xui.widgets.SelectUUopsnode=e.opsnode}var v=e.opsnode.childNodes;for(var u=0;u<v.length;u++){v[u].style.display="block"}if(xui.env.ua.ie>0&&xui.env.ua.ie<8){var h=e.opsnode.offsetWidth;if(e.opsnode.offsetHeight<e.opsnode.scrollHeight){for(var u=0;u<v.length;u++){v[u].style.width=h-20+"px"}}}});xui.util.Event.on([e.button,e.opsnode],"mouseout",function(){e.isclose=true;setTimeout(function(){e.close()},2000)});xui.util.Event.on([e.button,e.opsnode],"mouseover",function(){e.isclose=false})})(this);var k=this,m=true;xui.util.Event.on(document,"click",function(u){if(k.opsnode.style.display=="none"){return}var i=xui.util.Event.getTarget(u),h=true;while(i.parentNode&&h){i=i.parentNode;if(i.className&&i.className.toLowerCase().indexOf("xui-select")!=-1){h=false}}if(h){k.opsnode.style.display="none"}});return this},security:false,value:function(a){if(this.security){if(this.model){this.shownode.innerHTML=xui.util.StringUtil.unescapeHTML(a.text)}else{this.shownode.value=xui.util.StringUtil.unescapeHTML(a.text)}this.porobj.value=xui.util.StringUtil.unescapeHTML(a.value);this.proValue=xui.util.StringUtil.unescapeHTML(a.value)}else{if(this.model){this.shownode.innerHTML=a.text}else{this.shownode.value=a.text}this.porobj.value=a.value;this.proValue=a.value}},close:function(b){var a=this;if(this.opsnode.style.display=="none"){return}if(b){this.opsnode.style.display="none";try{this.porobj.onchange()}catch(c){}return}if(this.isclose&&this.autoClose){this.opsnode.style.display="none";return}else{setTimeout(function(){a.close()},2000)}},createSuggest:function(){var a=this;xui.util.Event.on(a.shownode,"click",function(){if(a.initValue&&a.shownode.value==a.initValue){a.shownode.value=""}});xui.util.Event.on(a.shownode,"keyup",function(){a.queryText()})},setOnlyValue:function(a){this.proValue=a},proValue:"",getValue:function(){return this.proValue},queryText:function(){var a=this.shownode.value;this.setOnlyValue(a);if(a.replace(/\s/,"").length<1){this.close(true);return}var d=this.opsnode.childNodes,e=0,b=0;for(var c=0;c<this.obj.length;c++){if(this.obj[c].o.text.indexOf(a)==-1){d[c].style.display="none"}else{e++;b=c;d[c].style.display="block"}}this.opsnode.style.display="block"},autoClose:false,setModel:function(a){if(a.autoClose){if(a.autoClose=="true"){this.autoClose=true}else{this.autoClose=false}}if(a.msg){this.value({text:a.msg,value:""})}if(a.suggest=="true"){this.autoClose=false;this.shownode.readOnly=false;this.createSuggest()}if(a.selectModel=="false"){this.button.style.display="none"}else{this.button.style.display="block"}if(a.initValue){if(a.initValue.constructor==String){a.initValue={text:a.initValue,value:a.initValue}}this.value(a.initValue)}},select:function(b,a){for(var c in this.obj){if(a){if(this.obj[c].o.text==b){this.setModel({initValue:this.obj[c].o});this.index=c;return}}else{if(this.obj[c].o.value==b){this.setModel({initValue:this.obj[c].o});this.index=c;return}}}},selectByIndex:function(a){if(a.constructor!=Number){return}if(a>this.obj.length-1||a<0){return}this.setModel({initValue:this.obj[a].o});this.index=a},remove:function(a,b){var c=null;if(a.constructor==Number){c=a}else{for(var d=0;d<this.obj.length;d++){if(b){if(this.obj[d].o.value==b){c=d;break}}else{if(this.obj[d].o.text==a){c=d;break}}}}if(c==null){return}this.opsnode.removeChild(this.obj[c].node);for(var d=c;d<this.obj.length-1;d++){this.obj[d]=this.obj[d+1]}this.obj.length=this.obj.length-1;if(c==this.index){this.value(this.obj[0].o);this.index=0}},index:0,add:function(b,a){var c;if(b.constructor==Object){c=b}else{c={text:b,value:a}}this._inertChild(c)},_inertChild:function(b){var a=document.createElement("div");a.innerHTML=b.text;this.opsnode.appendChild(a);this.obj.push({o:b,node:a});(function(d,c){xui.util.Event.on(d.node,"mouseover",function(){c.isclose=false;d.node.className="xui-select-hover"});xui.util.Event.on(d.node,"mouseout",function(){c.isclose=true;d.node.className=""});xui.util.Event.on(d.node,"click",function(){if(!c.onselect()){return}c.select(d.o.value);c.close(true);c.change()})})({o:b,node:a},this)},change:function(){},onselect:function(){return true},click:function(){return true},reLoad:function(){this.init(this.porobj.id)},load:function(a){this.opsnode.innerHTML="";this.value({text:"",value:""});this.obj=[];this.addList(a)},addList:function(c){for(var b=0,a=c.length;b<a;b++){this._inertChild(c[b])}},show:function(){$(this.id).style.display="block"},hide:function(){$(this.id).style.display="none"}};xui.widgets.SelectUUopsnode="";
