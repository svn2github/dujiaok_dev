xui.widgets.Dialog=function(d,a){this.id=d;this.attrs=a?a:null;this.attrs.reposition=(this.attrs&&this.attrs.reposition)?this.attrs.reposition:false;this.attrs.positionId=(this.attrs&&this.attrs.positionId)?this.attrs.positionId:false;this.attrs.positionOffset=(this.attrs&&this.attrs.positionOffset)?this.attrs.positionOffset:[0,0];this.attrs.borderStyle=(this.attrs&&this.attrs.borderStyle)?this.attrs.borderStyle:false;this.attrs.borderMargin=(this.attrs&&this.attrs.borderMargin!==false)?this.attrs.borderMargin:false;this.attrs.backgroundColor=(this.attrs&&this.attrs.backgroundColor)?this.attrs.backgroundColor:false;this.attrs.closeBtnStyle=(this.attrs&&this.attrs.closeBtnStyle)?this.attrs.closeBtnStyle:false;this.attrs.positionTop=(this.attrs&&this.attrs.positionTop)?this.attrs.positionTop:false;this.attrs.isAutoSize=(this.attrs&&this.attrs.isAutoSize)?this.attrs.isAutoSize:false;this.attrs.isAdd=(this.attrs&&!(typeof this.attrs.isAdd=="undefined"||this.attrs.isAdd==null)&&!this.attrs.isAdd)?this.attrs.isAdd:true;this._events={};if($(this.id)){return}var b=document.createElement("div");b.setAttribute("id",this.id);b.style.position="absolute";b.style.zIndex="9";b.style.display="none";document.body.appendChild(b);if($(this.id+"_bglayer")){return}var c=document.createElement("div");c.setAttribute("id",this.id+"_bglayer");c.style.position="absolute";c.style.left="0";c.style.top="0";c.style.background="#cccccc";c.style.zIndex=8;if(xui.env.ua.ie>0){c.style.filter="alpha(opacity=60)"}else{c.style.opacity="0.6"}if(xui.env.ua.ie>0&&xui.env.ua.ie<7){c.innerHTML=$Shim()}c.style.display="none";document.body.appendChild(c)};xui.widgets.Dialog.prototype={get:function(a){return this.attrs?this.attrs[a]:null},set:function(b,a,c){if(!b){return}if(!this.attrs){this.attrs={}}this.attrs[b]=a;if(b=="width"){var d=$(this.id+"_bar");if(d){d.style.width=(a?a:0)+"px"}}else{if(b=="height"){var d=$(this.id+"_content");if(d){d.style.height=(a-50)+"px"}d=$(this.id+"_ifr");if(d){d.style.height=(a-50)+"px"}if(xui.env.ua.ie>0&&xui.env.ua.ie<7){d=$(this.id+"_shim");if(d){d.style.height=(a-13)+"px"}}}else{if(b=="title"){var d=$(this.id+"_title");if(d){d.innerHTML=a?a:""}}else{if(b=="lable"){var d=$(this.id+"_lable");if(d){d.innerHTML=a?a:""}}}}}var c=(!(typeof c=="undefined"||c==null)&&!c)?c:true;if(c){this._position($(this.id))}},_html:function(){var d=[],e="";var b=this.attrs.lable?this.attrs.lable:"";d.push('<div id="'+this.id+'_bar" class="xui-dialog-bg" style="width:'+this.attrs.width+'px;">');d.push('<div class="xui-dialog-border" style="'+((this.attrs.borderMargin!==false)?"margin:"+this.attrs.borderMargin+"px;":"")+" "+(this.attrs.borderStyle?"border:"+this.attrs.borderStyle+";":" ")+'">');d.push('<div class="xui-dialog-titlebar" style="'+(this.attrs.backgroundColor?"background-color:"+this.attrs.backgroundColor:" ")+'">');d.push('<span class="xui-dialog-titlebar-button"><span id="'+this.id+'_close" href="javascript:void(0)" class="xui-dialog-titlebar-close" style="'+(this.attrs.closeBtnStyle?this.attrs.closeBtnStyle:"")+'"></span></span>');if(this.attrs.title){d.push('<label id="'+this.id+'_title" class="xui-dialog-title">'+this.attrs.title+'</label><span class="xui-dialog-title2" ></span>')}d.push('<span class="xui-dialog-title-lable" id="'+this.id+'_lable">'+b+"</span></div>");var a=this.attrs.height-60;d.push('<div id="'+this.id+'_content" class="xui-dialog-content" style="height:'+a+"px;"+(this.attrs.backgroundColor?"background-color:"+this.attrs.backgroundColor:" ")+'">');if(this.attrs.content["url"]){var f=this.attrs.isAutoSize?"no":"auto";var c=this.attrs.content["url"];if(c.indexOf("?")!=-1){c+="&t="+new Date().getTime()}else{c+="?t="+new Date().getTime()}d.push('<iframe id="'+this.id+'_ifr" src="'+c+'" style="overflow:hidden;width:100%;height:'+a+'px;" frameborder="0" scrolling="'+f+'"/>')}else{if(this.attrs.content["txt"]){d.push('<div id="'+this.id+'_txt">'+this.attrs.content["txt"]+"</div>")}}if(xui.env.ua.ie>0&&xui.env.ua.ie<7){d.push($Shim(this.id+"_shim","",this.attrs.width,this.attrs.height-13))}d.push("</div></div></div>");return d.join("")},_position:function(b){var a=$Canvas();b.style.left=!this.attrs.width?"0px":parseInt((a.clientWidth-this.attrs.width)/2)+a.scrollLeft+"px";if(this.attrs.positionTop){if(parent){b.style.top=parent.document.documentElement.scrollTop+this.attrs.positionTop+"px"}else{b.style.top=document.documentElement.scrollTop+this.attrs.positionTop+"px"}}else{var c=parseInt((a.clientHeight-this.attrs.height)/2)+a.scrollTop;b.style.top=!this.attrs.height?"0px":(c<0?0:c)+"px"}},_positionBGLayer:function(b){var a=$Canvas();b.style.width=a.scrollWidth+"px";b.style.height=(a.clientHeight>a.scrollHeight?a.clientHeight:a.scrollHeight)+"px"},open:function(){this._fire("beforeOpen");var a=this;if(this.attrs.modal){var d=$(this.id+"_bglayer");this._positionBGLayer(d);d.style.display=""}var b=$(this.id);b.innerHTML=this._html();if(this.attrs.reposition){this.reposition(this.attrs.reposition)}else{if(this.attrs.positionId){this.positionToElement()}else{this._position(b)}}b.style.display="";xui.util.Event.on(this.id+"_close","click",function(f){this.cancelClose();xui.util.Event.stopPropagation(f)},null,this);if(this.attrs.content["url"]&&$Listen){xui.util.Event.on(this.id+"_ifr","load",function(f){if(this.contentWindow&&this.contentWindow.$Listen){this.contentWindow.$Listen("close",function(){a.close()});this.contentWindow.$Listen("cancel",function(){a.cancelClose()})}},null)}if(this.attrs.isAutoSize){var c=this;window.setInterval(function(){c._autoSize()},400)}return this},close:function(){$(this.id).style.display="none";var a=$(this.id+"_bglayer");if(a){a.style.display="none"}this._fire("afterClose")},cancelClose:function(){$(this.id).style.display="none";var a=$(this.id+"_bglayer");if(a){a.style.display="none"}this._fire("cancelClose");this._fire("afterClose")},reposition:function(a){$(this.id).style.left=a[0]+"px";$(this.id).style.top=a[1]+"px";return this},positionToElement:function(c,a){var b=c?xui.util.Dom.getXY($(c)):xui.util.Dom.getXY($(this.attrs.positionId));var a=a?a:this.attrs.positionOffset;this.reposition([b[0]+a[0],b[1]+a[1]]);return this},_fire:function(b,f){var a=this._events[b];if(a){try{a.call(this,f)}catch(c){alert(c.message)}}},reload:function(a){if(this.attrs.content["url"]){$(this.id+"_ifr").src=a}},on:function(b,a){this._events[b]=a},getInnerIframe:function(){return $(this.id+"_ifr").contentWindow},_autoSize:function(){var a=this;if(a.attrs.content["url"]){if(xui.env.ua.gecko>0||xui.env.ua.ie==8){$(a.id+"_ifr").style.height=100+"px"}try{var b=$(a.id+"_ifr").contentWindow.document.body.scrollHeight}catch(f){var b=520}try{var c=$(a.id+"_ifr").contentWindow.document.documentElement.scrollHeight}catch(f){var c=520}try{var k=$(a.id+"_ifr").contentWindow.document.body.scrollWidth}catch(f){var k=660}try{var g=$(a.id+"_ifr").contentWindow.document.documentElement.scrollWidth}catch(f){var g=660}var d=Math.max(b,c);var i=Math.max(k,g);if(xui.env.ua.gecko>0||xui.env.ua.ie==8){if(a.attrs.isAdd){i=i+18;a.set("width",i,false)}}else{i=i+18;if(a.attrs.isAdd){a.set("width",i,false)}}d=d+50;a.set("height",d,false);if(a.attrs.modal){var j=$(a.id+"_bglayer");a._positionBGLayer(j)}a.attrs.isAdd=false}else{xui.util.Event.onContentReady(a.id+"_txt",function(){var e=($(a.id+"_txt").clientWidth);var l=($(a.id+"_txt").clientHeight)})}}};
