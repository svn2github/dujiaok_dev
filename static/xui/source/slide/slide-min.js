xui.widgets.Slide=(function(){var i=xui.util.Dom,c=xui.util.Event,f=xui.util.CustomEvent,d=xui.util.Anim;var a="",h=null;var g=false,e=false;var b=function(j){this.attrs={container:$("container"),content:$("content"),panelCl:"circularPanel",triggerCl:"circularTrigger",currentTriggerCl:"on",autoplay:true,interval:5,duration:0.5,currentIndex:0,onSwitchTriggerBefore:function(){}};this.attrs=$merge(this.attrs,j);h=this;this._events=[];this._initEnvents("onSwitched");this._initEnvents("onSwitchTriggerBefore");this.container=this.attrs.container;this.content=this.attrs.content;this.panels=i.getElementsByClassName(this.attrs.panelCl);this.triggers=i.getElementsByClassName(this.attrs.triggerCl);this.currentIndex=this.attrs.currentIndex;this.length=this.panels.length;this.viewDiff=this.panels[0].offsetWidth;this._timer=function(){};this.paused=false;this._bind();this._switchTo(this.currentIndex);this.run()};b.prototype={_circularScroll:function(j){var m=this.currentIndex,l=j,k=false;this.diff=-this.viewDiff*l;e=(k&&m===0&&l===this.length-1)||(k===false&&m===this.length-1&&l===0);if(e){this.diff=this._adjustPosition(m,l,k)}if(h.anim){h.anim.stop()}h.anim=new d(this.content,{left:{to:this.diff}},this.attrs.duration);h.anim.onComplete.subscribe(function(){if(e){h._restPosition()}h._fire("onSwitched")});h.anim.animate()},_adjustPosition:function(n,m,k){var l=k?this.length-1:0,n=l,m=l+1,j;for(j=n;j<m;j++){i.setStyle(this.panels[j],"position","relative");i.setStyle(this.panels[j],"left",((k?-1:1)*this.viewDiff*this.length)+"px")}return k?this.viewDiff:-this.viewDiff*this.length},_restPosition:function(){var k=g?this.length-1:0,m=k,l=k+1,j;for(j=m;j<l;j++){i.setStyle(this.panels[j],"position",a);i.setStyle(this.panels[j],"left",a)}i.setStyle(this.content,"left",g?-this.viewDiff*(this.length-1):a)},run:function(){if(!this.attrs.autoplay){return}if(this.panels.length===1){return}this._timer=setInterval(function(){if(h.paused){return}h._switchTo(h.currentIndex<h.length-1?h.currentIndex+1:0)},this.attrs.interval*1000)},stop:function(){clearInterval(this._timer)},_switchTo:function(j){if(j!==this.currentIndex){if(this.currentIndex<this.length){this.currentIndex=this.currentIndex+1}if(this.currentIndex===this.length){this.currentIndex=0}}this._switchTrigger(j);this._circularScroll(j)},go:function(j){this.stop();if(e){h._restPosition()}this._switchTo(this.currentIndex=j);var k=function(){h.paused=false;this._removeEvent("onSwitched",k)};this.on("onSwitched",k)},prev:function(){this.stop();if(e){h._restPosition()}this._switchTo(this.currentIndex=(this.currentIndex>0?this.currentIndex-1:this.length-1));var j=function(){h.paused=false;this._removeEvent("onSwitched",j)};this.on("onSwitched",j)},next:function(){this.stop();if(e){h._restPosition()}this._switchTo(this.currentIndex=(this.currentIndex<this.length-1?this.currentIndex+1:0));var j=function(){h.paused=false;this._removeEvent("onSwitched",j)};this.on("onSwitched",j)},play:function(){this.paused=false},suspend:function(){this.paused=true},_switchTrigger:function(){this._fire("onSwitchTriggerBefore",[this.currentIndex,this.triggers[this.currentIndex]]);var j=this.triggers[this.currentIndex];$each(this.triggers,function(k){if(k==j){i.addClass(k,h.attrs.currentTriggerCl)}else{i.removeClass(k,h.attrs.currentTriggerCl)}})},_bind:function(){var k=this;var j=function(n,m,l){var o=n.relatedTarget||{mouseover:n.fromElement,mouseout:n.toElement}[l];if(o==undefined){return true}if(o===false){return false}return($type(m)!="document"&&o!=m&&o.prefix!="xul"&&(i.getElementsBy(function(p){if(p==o){return true}},"*",m).length==0))};c.on(this.container,"mouseover",function(l){l=c.getEvent(l);if(j(l,this,"mouseover")){k.paused=true}});c.on(this.container,"mouseout",function(l){l=c.getEvent(l);if(j(l,this,"mouseout")){h.play()}});c.on(this.triggers,"mouseover",function(){for(var l=0;l<h.triggers.length;l++){if(h.triggers[l]===this){h.currentIndex=l}}h._switchTo(h.currentIndex);h.paused=true});c.on(this.triggers,"mouseout",function(){h.paused=false});this.on("onSwitchTriggerBefore",this.attrs.onSwitchTriggerBefore)},on:function(j,k){var l=this;this._events[j].subscribe(k,l)},_initEnvents:function(j){var k=this;this._events[j]=new f(j,k)},_fire:function(k,j){this._events[k].fire.apply(this._events[k],j)},_removeEvent:function(j,k){var l=this;this._events[j].unsubscribe(k,l)}};return b})();
