/*pub-2|2011-11-09 16:29:46*/KISSY.Editor.add("xiami-music",function(a){function h(a){return/xiami\.com/i.test(a)}var b=KISSY,c=b.Editor,d="ke_xiami",e="xiami-music",f=a.htmlDataProcessor,g=f&&f.dataFilter;g&&g.addRules({elements:{object:function(a){var b=a.attributes,g=a.attributes.title,i,j,k=b.classid&&String(b.classid).toLowerCase();if(!k){for(i=0;i<a.children.length;i++){j=a.children[i];if(j.name=="embed"){if(!c.Utils.isFlashEmbed(j))return null;if(h(j.attributes.src))return f.createFakeParserElement(a,d,e,!0,{title:g})}}return null}for(i=0;i<a.children.length;i++){j=a.children[i];if(j.name=="param"&&j.attributes.name.toLowerCase()=="movie"&&h(j.attributes.value))return f.createFakeParserElement(a,d,e,!0,{title:g})}},embed:function(a){if(!c.Utils.isFlashEmbed(a))return null;if(h(a.attributes.src))return f.createFakeParserElement(a,d,e,!0,{title:a.attributes.title})}}},4),a.addPlugin("xiami-music",function(){var b=a.addButton("xiami-music",{contentCls:"ke-toolbar-music",title:"\u63d2\u5165\u867e\u7c73\u97f3\u4e50",mode:c.WYSIWYG_MODE,loading:!0});c.use("xiami-music/support",function(){var d=new c.XiamiMusic(a);b.reload({offClick:function(){d.show()},destroy:function(){d.destroy()}})}),this.destroy=function(){b.destroy()}})},{attach:!1,requires:["fakeobjects"]}),KISSY.Editor.add("xiami-music/support",function(){function g(d){g.superclass.constructor.apply(this,arguments);var f=d.cfg.disableObjectResizing;f||e.on(d.document.body,b.ie?"resizestart":"resize",function(b){var d=new a.Node(b.target);d.hasClass(c)&&b.preventDefault()})}function h(a){return a._4e_name()==="img"&&!!a.hasClass(c)&&a}var a=KISSY,b=a.UA,c="ke_xiami",d="xiami-music",e=a.Event,f=a.Editor;a.extend(g,f.Flash,{_config:function(){var a=this;a._cls=c,a._type=d,a._contextMenu=i,a._flashRules=["img."+c]},_updateTip:function(a,b){var c=this,d=c.editor,e=d.restoreRealElement(b);if(!e)return;a.html(b.attr("title")),a.attr("href",c._getFlashUrl(e))}});var i={"\u867e\u7c73\u5c5e\u6027":function(a){var b=a.editor,c=b.getSelection(),d=c&&c.getStartElement(),e=h(d);e&&a.show(null,e)}};f.Flash.registerBubble(d,"\u867e\u7c73\u97f3\u4e50\uff1a ",h),f.XiamiMusic=g,f.add({"xiami-music/dialog":{attach:!1,charset:"utf-8",fullpath:f.Utils.debugUrl("../biz/ext/plugins/music/dialog/plugin.js")}}),f.add({"xiami-music/dialog/support":{attach:!1,charset:"utf-8",requires:["flash/dialog/support"],fullpath:f.Utils.debugUrl("../biz/ext/plugins/music/dialog/support/plugin.js")}})},{attach:!1,requires:["flash/support"]}),KISSY.Editor.add("checkbox-sourcearea",function(a){var b=KISSY.Editor,c=KISSY,d=c.UA;if(d.gecko<1.92)return;b.use("checkbox-sourcearea/support",function(){var c=new b.CheckboxSourceArea(a);a.on("destroy",function(){c.destroy()})})},{attach:!1}),KISSY.Editor.add("checkbox-sourcearea/support",function(){function f(a){this.editor=a,this._init()}var a=KISSY,b=a.Editor,c=a.Node,d=b.SOURCE_MODE,e=b.WYSIWYG_MODE;a.augment(f,{_init:function(){var a=this,b=a.editor,d=b.statusDiv;a.holder=(new c("<span style='zoom:1;display:inline-block;height:22px;line-height:22px;'><input style='margin:0 5px;vertical-align:middle;' type='checkbox' /><span style='vertical-align:middle;'>\u7f16\u8f91\u6e90\u4ee3\u7801</span></span>")).appendTo(d),a.el=a.holder.one("input");var e=a.el;e.on("click",a._check,a),b.on("sourcemode",function(){e[0].checked=!0}),b.on("wysiwygmode",function(){e[0].checked=!1})},_check:function(){var a=this,b=a.el;b[0].checked?a._show():a._hide()},_show:function(){var a=this,c=a.editor;b.SourceAreaSupport.exec(c,d)},_hide:function(){var a=this,c=a.editor;b.SourceAreaSupport.exec(c,e)},destroy:function(){this.el.detach(),this.holder.remove()}}),b.CheckboxSourceArea=f},{attach:!1,requires:["sourcearea/support"]}),KISSY.Editor.add("multi-upload",function(a){var b=KISSY,c=b.Editor;c.Env.mods["multi-upload/dialog"]||(c.add({"multi-upload/dialog":{attach:!1,charset:"utf-8",fullpath:c.Utils.debugUrl("../biz/ext/plugins/upload/dialog/plugin.js")}}),c.add({"multi-upload/dialog/support":{attach:!1,charset:"utf-8",requires:["progressbar","localstorage","overlay"],fullpath:c.Utils.debugUrl("../biz/ext/plugins/upload/dialog/support/plugin.js")}})),a.addPlugin("multi-upload",function(){var b=a.addButton("multi-upload",{contentCls:"ke-toolbar-mul-image",title:"\u6279\u91cf\u63d2\u56fe",mode:c.WYSIWYG_MODE,offClick:function(){var a=this.editor;a.showDialog("multi-upload/dialog")},destroy:function(){this.editor.destroyDialog("multi-upload/dialog")}});this.destroy=function(){b.destroy()}})},{attach:!1}),KISSY.Editor.add("video",function(a){function f(a){for(var b=0;b<g.length;b++){var c=g[b];if(c.reg.test(a))return c}return undefined}var b=KISSY,c=b.Editor,d=a.htmlDataProcessor,e=d&&d.dataFilter,g=[],h=a.cfg.pluginConfig;h.video=h.video||{};var i=h.video;i.providers&&g.push.apply(g,i.providers),i.getProvider=f;var j="ke_video",k="video";e&&e.addRules({elements:{object:function(a){var b=a.attributes,e,g=b.classid&&String(b.classid).toLowerCase();if(!g){for(e=0;e<a.children.length;e++)if(a.children[e].name=="embed"){if(!c.Utils.isFlashEmbed(a.children[e]))return null;if(f(a.children[e].attributes.src))return d.createFakeParserElement(a,j,k,!0)}return null}for(e=0;e<a.children.length;e++){var h=a.children[e];if(h.name=="param"&&h.attributes.name.toLowerCase()=="movie"&&f(h.attributes.value))return d.createFakeParserElement(a,j,k,!0)}},embed:function(a){if(!c.Utils.isFlashEmbed(a))return null;if(f(a.attributes.src))return d.createFakeParserElement(a,j,k,!0)}}},4),a.addPlugin("video",function(){var b=a.addButton("video",{contentCls:"ke-toolbar-video",title:"\u63d2\u5165\u89c6\u9891",mode:c.WYSIWYG_MODE,loading:!0});c.use("video/support",function(){var d=new c.Video(a);b.reload({offClick:function(){d.show()},destroy:function(){d.destroy()}})}),this.destroy=function(){b.destroy()}})},{attach:!1,requires:["fakeobjects"]}),KISSY.Editor.add("video/support",function(){function g(a){g.superclass.constructor.apply(this,arguments)}function h(a){return a._4e_name()==="img"&&!!a.hasClass(d)&&a}var a=KISSY,b=a.Editor,c=b.Flash,d="ke_video",e="video",f=["img."+d];g.CLS_VIDEO=d,g.TYPE_VIDEO=e,a.extend(g,c,{_config:function(){var a=this;a._cls=d,a._type=e,a._contextMenu=i,a._flashRules=f}}),c.registerBubble("video","\u89c6\u9891\u94fe\u63a5\uff1a ",h),b.Video=g;var i={"\u89c6\u9891\u5c5e\u6027":function(a){var b=a.editor,c=b.getSelection(),d=c&&c.getStartElement(),e=d&&h(d);e&&a.show(null,e)}};b.add({"video/dialog":{attach:!1,charset:"utf-8",fullpath:b.Utils.debugUrl("../biz/ext/plugins/video/dialog/plugin.js")}}),b.add({"video/dialog/support":{attach:!1,charset:"utf-8",requires:["flash/dialog/support"],fullpath:b.Utils.debugUrl("../biz/ext/plugins/video/dialog/support/plugin.js")}})},{attach:!1,requires:["flash/support"]});