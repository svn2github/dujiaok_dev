KISSY.Editor.add("walker",function(s){function m(e,c){if(this._.end)return i;var a,b=this.range,f,n=this.guard,o=this.type,t=e?"_4e_previousSourceNode":"_4e_nextSourceNode";if(!this._.start){this._.start=1;b.trim();if(b.collapsed){this.end();return i}}if(!e&&!this._.guardLTR){var u=b.endContainer,v=new p(u[0].childNodes[b.endOffset]);this._.guardLTR=function(d,j){return(d=q._4e_wrap(d))&&d[0]&&(!j||!q._4e_equals(u,d))&&(!v[0]||!d._4e_equals(v))&&(d[0].nodeType!=l.NODE_ELEMENT||!j||d._4e_name()!="body")}}if(e&&
!this._.guardRTL){var w=b.startContainer,x=b.startOffset>0&&new p(w[0].childNodes[b.startOffset-1]);this._.guardRTL=function(d,j){return(d=q._4e_wrap(d))&&d[0]&&(!j||!d._4e_equals(w))&&(!x[0]||!d._4e_equals(x))&&(d[0].nodeType!=l.NODE_ELEMENT||!j||d._4e_name()!="body")}}var y=e?this._.guardRTL:this._.guardLTR;f=n?function(d,j){if(y(d,j)===g)return g;return n(d,j)}:y;if(this.current)a=this.current[t](g,o,f);else if(e){a=b.endContainer;if(b.endOffset>0){a=new p(a[0].childNodes[b.endOffset-1]);if(f(a)===
g)a=i}else a=f(a,h)===g?i:a._4e_previousSourceNode(h,o,f)}else{a=b.startContainer;if((a=new p(a[0].childNodes[b.startOffset]))&&a[0]){if(f(a)===g)a=i}else a=f(b.startContainer,h)===g?i:b.startContainer._4e_nextSourceNode(h,o,f)}for(;a&&a[0]&&!this._.end;){this.current=a;if(!this.evaluator||this.evaluator(a)!==g){if(!c)return a}else if(c&&this.evaluator)return g;a=a[t](g,o,f)}this.end();return this.current=i}function z(e){for(var c,a=i;c=m.call(this,e);)a=c;return a}function k(e){this.range=e;this._=
{}}var h=true,g=false,i=null,r=KISSY,l=s.NODE,q=r.DOM,p=r.Node;r.augment(k,{end:function(){this._.end=1},next:function(){return m.call(this)},previous:function(){return m.call(this,h)},checkForward:function(){return m.call(this,g,h)!==g},checkBackward:function(){return m.call(this,h,h)!==g},lastForward:function(){return z.call(this)},lastBackward:function(){return z.call(this,h)},reset:function(){delete this.current;this._={}}});k.blockBoundary=function(e){return function(c){c=q._4e_wrap(c);return!(c&&
c[0].nodeType==l.NODE_ELEMENT&&c._4e_isBlockBoundary(e))}};k.bookmark=function(e,c){function a(b){return b&&b[0]&&b._4e_name()=="span"&&b.attr("_ke_bookmark")}return function(b){var f,n;f=b&&b[0]&&b[0].nodeType==l.NODE_TEXT&&(n=b.parent())&&a(n);f=e?f:f||a(b);return c^f}};k.whitespaces=function(e){return function(c){c=(c=c[0]||c)&&c.nodeType==l.NODE_TEXT&&!r.trim(c.nodeValue);return e^c}};k.invisible=function(e){var c=k.whitespaces();return function(a){a=c(a)||a[0].nodeType==l.NODE_ELEMENT&&!a[0].offsetHeight;
return e^a}};s.Walker=k});
