KISSY.Editor.add("clipboard",function(o){var i=KISSY,k=i.Editor,m=i.Node,j=i.UA,s=k.Range,p=k.RANGE,q=i.Event;k.Paste||function(){function r(a){this.editor=a;this._init()}function t(a){if(!(!j.ie||a.document.compatMode=="BackCompat")){var c=a.getSelection(),d;if(c.getType()==u.SELECTION_ELEMENT&&(d=c.getSelectedElement())){var f=c.getRanges()[0],b=new m(a.document.createTextNode(""));b.insertBefore(d);f.setStartBefore(b);f.setEndAfter(d);c.selectRanges([f]);setTimeout(function(){if(d.parent()){b.remove();
c.selectElement(d)}},0)}}}function v(a,c){l=1;var d=true;try{d=c.queryCommandEnabled(a)?true:false}catch(f){}l=0;return d}i.augment(r,{_init:function(){var a=this.editor;q.on(a.document.body,j.webkit?"paste":j.gecko?"paste":"beforepaste",this._paste,this);q.on(a.document.body,"contextmenu",function(){l=1;setTimeout(function(){l=0},10)});a.addCommand("copy",new n("copy"));a.addCommand("cut",new n("cut"));a.addCommand("paste",new n("paste"))},_paste:function(a){if(!l){i.log(a.type+" :  paste event happen");
var c=this.editor,d=c.document;if(d.getElementById("ke_pastebin"))i.log(a.type+" : trigger more than once ...");else{var f=c.getSelection();a=new s(d);var b=new m(j.webkit?"<body></body>":"<div></div>",null,d);b.attr("id","ke_pastebin");j.webkit&&b[0].appendChild(d.createTextNode("\u00a0"));d.body.appendChild(b[0]);b.css({position:"absolute",top:f.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"});b.css("left","-1000px");var g=f.createBookmarks();a.setStartAt(b,p.POSITION_AFTER_START);
a.setEndAt(b,p.POSITION_BEFORE_END);a.select(true);setTimeout(function(){b._4e_remove();var e;b=j.webkit&&(e=b._4e_first())&&e.hasClass("Apple-style-span")?e:b;f.selectBookmarks(g);e=b.html();if(e=i.trim(e.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/ig,""))){i.log("paster "+e);var h=c.fire("paste",{html:e,holder:b});if(h!==undefined)e=h;h=null;if(/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(e))h=c.htmlDataProcessor.wordFilter;c.insertHtml(e,h)}},0)}}}});k.Paste=r;var w=function(a,
c){var d=a.document,f=new m(d.body),b=false,g=function(){b=true};f.on(c,g);(j.ie>7?d:d.selection.createRange()).execCommand(c);f.detach(c,g);return b},x=j.ie?function(a,c){return w(a,c)}:function(a,c){try{return a.document.execCommand(c)}catch(d){return false}},y={cut:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u526a\u5207\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+X)\u6765\u5b8c\u6210",copy:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u590d\u5236\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+C)\u6765\u5b8c\u6210",paste:"\u60a8\u7684\u6d4f\u89c8\u5668\u5b89\u5168\u8bbe\u7f6e\u4e0d\u5141\u8bb8\u7f16\u8f91\u5668\u81ea\u52a8\u6267\u884c\u7c98\u8d34\u64cd\u4f5c\uff0c\u8bf7\u4f7f\u7528\u952e\u76d8\u5feb\u6377\u952e(Ctrl/Cmd+V)\u6765\u5b8c\u6210"},n=function(a){this.type=a;this.canUndo=this.type=="cut"};n.prototype={exec:function(a){this.type==
"cut"&&t(a);(a=x(a,this.type))||alert(y[this.type]);return a}};var u=k.Selection,z={copy:"\u590d\u5236",paste:"\u7c98\u8d34",cut:"\u526a\u5207"},l;k.on("contextmenu",function(a){var c=a.contextmenu,d=c.cfg.editor,f=c.elDom,b={copy:0,cut:0,paste:0},g;for(g in b){if(!b.hasOwnProperty(g))break;b[g]=f.one(".ke-paste-"+g);(function(e){var h=b[e];if(!h){h=(new m("<a href='#'class='ke-paste-"+e+"'>"+z[e]+"</a>")).appendTo(f);h.on("click",function(A){A.halt();if(!h.hasClass("ke-menuitem-disable")){c.hide();setTimeout(function(){d.execCommand(e)},
30)}})}b[e]=h})(g);a=b[g];v(g,d.document)?a.removeClass("ke-menuitem-disable"):a.addClass("ke-menuitem-disable")}})}();o.ready(function(){new k.Paste(o)})},{attach:false});
