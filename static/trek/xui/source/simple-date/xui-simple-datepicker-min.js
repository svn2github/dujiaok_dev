xui.widgets.simpleDatePicker=function(d,b,a,c){this.config=c;this._disTime=new Array();this.tms=true;this.obj={};if(d){this.id="xui-dp-"+d;this.user=$(d);if(b){this.tmpl=b}else{this.tmpl="YYYY-MM-DD hh:mm:ss"}this.setTmpl();if(a){this.setAttr(a)}else{if($(d).value){this.setAttr($(d).value)}}this.initObj();this.init();this.getValue()}else{this.initObj()}};xui.widgets.simpleDatePicker.prototype={html:'<div class="xui-dp-ym"><div class="xui-dp-month"><span id="#month"></span><a href="javascript:void(0)" id="#mbtn" class="xui-dp-btn-month"></a></div><div class="xui-dp-year"><span id="#year"></span><b class="xui-dp-btn"><a href="javascript:void(0)" class="xui-dp-btn-pre" id="#pre"></a><a href="javascript:void(0)" class="xui-dp-btn-next" id="#next"></a></b></div></div><div class="xui-dp-day" id="#day"></div><div class="xui-dp-hms"><div id="#tms"><a href="javascript:void(0)" id="#hh"></a><span>\u65f6</span><a href="javascript:void(0)" id="#mm"></a><span>\u5206</span><a href="javascript:void(0)" id="#ss"></a><span>\u79d2</span></div><a href="javascript:void(0)" id="#submit" class="xui-dp-sub">\u786e\u5b9a</a><a href="javascript:void(0)" id="#close" class="xui-dp-close">\u6e05\u9664</a></div>',obj:{},setTmpl:function(){this.Tmpls=new Array();this.Tmpls.push(this.tmpl.replace(/[^Y+]/g,""));this.Tmpls.push(this.tmpl.replace(/[^M+]/g,""));this.Tmpls.push(this.tmpl.replace(/[^D+]/g,""));this.Tmpls.push(this.tmpl.replace(/[^h+]/g,""));this.Tmpls.push(this.tmpl.replace(/[^m+]/g,""));this.Tmpls.push(this.tmpl.replace(/[^s+]/g,""));var a=this.tmpl.indexOf("ms");if(a!=-1){this.Tmpls.push("ms")}else{this.Tmpls.push("")}this.Tmpls.push(this.tmpl.replace(/[^d+]/g,""));a=this.tmpl.indexOf("$");if(a!=-1){this.Tmpls.push(this.tmpl.substr(a+1))}else{this.Tmpls.push("")}},setOutInner:function(){var f=this.id.replace("xui-dp-","");var a=xui.util.Dom.getStyle(f,"width");try{a=="auto"?a="128":a=parseInt(a)}catch(b){a=128}this.user.style.display="none";var c=document.createElement("div");c.id=this.id+"-box";c.className="xui-dp-box";c.style.position="relative";c.style.width=a+"px";c.innerHTML='<span id="'+this.id+'-call" class="xui-dp-call"></span><span class="xui-dp-value" id="'+this.id+'-value" style="width:'+(a-20)+'px"></span>';this.user.parentNode.insertBefore(c,this.user)},initObj:function(){if(!this.DATE){this.DATE=new Date()}},setInner:function(){var a=document.createElement("div");a.id=this.id;a.className="xui-dp";a.innerHTML=this.html.replace("#year",this.id+"-year").replace("#month",this.id+"-month").replace("#pre",this.id+"-pre").replace("#next",this.id+"-next").replace("#day",this.id+"-db").replace("#hh",this.id+"-hour").replace("#mm",this.id+"-minute").replace("#ss",this.id+"-second").replace("#mbtn",this.id+"-btn-m").replace("#close",this.id+"-close").replace("#submit",this.id+"-submit").replace("#tms",this.id+"-tms");document.body.appendChild(a);this.setInnerYear();this.setInnerMonth();this.setInnerDay();this.setInnerHMS()},setInnerYear:function(){this.obj._year=$(this.id+"-year");this.obj._year.innerHTML=this.getYear(this.DATE)},setInnerMonth:function(){this.obj._month=$(this.id+"-month");var b='<div class="xui-dp-md" id="'+this.id+'-md">';for(var a=1;a<=12;a++){if(a==this.DATE.getMonth()+1){this.obj._month.innerHTML=a+"\u6708"}b+='<a href="javascript:void(0)">'+a+"\u6708</a>"}b+="</div>";$(this.id).innerHTML+=b},setInnerDay:function(){this.obj._day=$(this.id+"-db");var n="<table><tr><th>\u65e5</th><th>\u4e00</th><th>\u4e8c</th><th>\u4e09</th><th>\u56db</th><th>\u4e94</th><th>\u516d</th></tr>",p=this.DATE.getDate(),l=this.getYear(this.DATE),z=this.DATE.getMonth()+1,q=new Date(l,z),m=new Date(q.getTime()-1),u=new Date(l,z-1),b=u.getDay(),u=new Date(u.getTime()-1),g=u.getDate(),v=m.getDate(),h=0,j=1,w=true,o="xui-dp-a",y="",k="pre";if(this.config&&this.config.selectModel=="week"){n+="<tr onmouseover=\"this.style.backgroundColor = '#00b7e3'\" onmouseout=\"this.style.backgroundColor = 'transparent'\">"}else{n+="<tr>"}for(var r=0;r<42;r++){if(h==7){h=0;if(this.config&&this.config.selectModel=="week"){n+="</tr><tr onmouseover=\"this.style.backgroundColor = '#00b7e3'\" onmouseout=\"this.style.backgroundColor = 'transparent'\">"}else{n+="</tr><tr>"}}if(j==p&&w){y=" xui-dp-nowday"}else{y=""}var e='<td><a href="javascript:void(0)" class="#class#">#d#</a></td>',c="xui-dp-noa",x="";if(r<7){if(r<b){var s=g-(b-r)+1;x=s}else{k="now";c="xui-dp-a"+y;x=j;j++}}else{if(j>v){j=1;o="xui-dp-noa";y="";w=false;k="next"}c=o+y;x=j;j++}var a="";if(k=="pre"){a=u}else{if(k=="next"){a=q}else{a=m}}a.setDate(x);if(this.isDisTime(a)){e='<td><span class="#class#">#d#</span></td>'}n+=e.replace("#class#",c).replace("#d#",x);h++}n+="</tr></table>";this.obj._day.innerHTML=n;this.initEventDd()},setInnerHMS:function(){this.obj._hour=$(this.id+"-hour");this.obj._minute=$(this.id+"-minute");this.obj._second=$(this.id+"-second");this.obj._hour.innerHTML=this.DATE.getHours();this.obj._minute.innerHTML=this.DATE.getMinutes();this.obj._second.innerHTML=this.DATE.getSeconds();var d='<div class="xui-dp-dialog" id="'+this.id+'-h">',c='<div class="xui-dp-dialog" id="'+this.id+'-m">',b='<div class="xui-dp-dialog" id="'+this.id+'-s">';for(var a=0;a<60;a++){if(a<24){d+='<a href="javascript:void(0)">'+a+"</a>"}c+='<a href="javascript:void(0)">'+a+"</a>";b+='<a href="javascript:void(0)">'+a+"</a>"}d+="</div>";c+="</div>";b+="</div>";$(this.id).innerHTML+=d+c+b},clearDate:function(){var a=this;$(a.id+"-value").innerHTML="";$(a.id.replace("xui-dp-","")).value="";$(a.id).style.display="none"},init:function(){this.setOutInner();this.setInner();this.initEvent();var a=this;xui.util.Event.on($(this.id+"-close"),"click",function(){a.clearDate()});xui.util.Event.on($(this.id+"-submit"),"click",function(){a.select();$(a.id).style.display="none"});xui.util.Event.on(document,"click",function(g){if($(a.id).style.display=="none"){return}var d=YAHOO.util.Event.getTarget(g),c=true;while(d&&c){if(d.className&&d.className.toLowerCase().indexOf("xui-dp")!=-1){c=false}for(var b=0;b<a.documentExitId.length;b++){if($(a.documentExitId[b])==d){c=false}}d=d.parentNode}if(c){$(a.id).style.display="none"}})},documentExitId:[],setAttr:function(a){if(a.constructor==Date){this.DATE=new Date(a)}else{if(a.constructor==Array){this.setAttrByArray(a)}else{if(a.constructor==Object){this.setAttrByObject(a)}else{if(a.constructor==String){this.setAttrByString(a)}else{if(/^\d+$/.test(a)){this.setAttrByNumber(a)}}}}}},close:function(){$(this.id).style.display="none"},initEvent:function(){this.initEventCall();this.initEventYd();this.initEventMd();this.initEventDd();this.initEventHmsd()},initEventCall:function(){var a=this;xui.util.Event.on([$(this.id+"-call"),$(this.id+"-value")],"click",function(){a.show()})},show:function(d){var a=xui.util.Dom.getX(this.id+"-box"),e=xui.util.Dom.getY(this.id+"-box"),c=$(this.id+"-box").offsetHeight;if(d&&d.nodeType){a=xui.util.Dom.getX(d);e=xui.util.Dom.getY(d);c=d.offsetHeight}var b=$Canvas().clientWidth;if(a+186>b){a=b-186}$(this.id).style.left=a+"px";$(this.id).style.top=(e+c)+"px";$(this.id).style.display="block";$(this.id+"-md").style.display="none"},initEventHmsd:function(){var d=this;xui.util.Event.on($(this.id+"-hour"),"click",function(){$(d.id+"-h").style.display="block"});xui.util.Event.on($(this.id+"-minute"),"click",function(){$(d.id+"-m").style.display="block"});xui.util.Event.on($(this.id+"-second"),"click",function(){$(d.id+"-s").style.display="block"});xui.util.Event.on($(this.id+"-hour"),"mouseout",function(){d.obj.closeHhd=true;setTimeout(function(){d.closeHhd()},2000)});xui.util.Event.on($(this.id+"-minute"),"mouseout",function(){d.obj.closeMmd=true;setTimeout(function(){d.closeMmd()},2000)});xui.util.Event.on($(this.id+"-second"),"mouseout",function(){d.obj.closeSsd=true;setTimeout(function(){d.closeSsd()},2000)});var b=$(this.id+"-h").getElementsByTagName("a");var c=$(this.id+"-m").getElementsByTagName("a");var a=$(this.id+"-s").getElementsByTagName("a");xui.util.Event.on(b,"click",function(){d.setHours(this.innerHTML)});xui.util.Event.on(c,"click",function(){d.setMinutes(this.innerHTML)});xui.util.Event.on(a,"click",function(){d.setSeconds(this.innerHTML)});xui.util.Event.on(b,"mouseout",function(){d.obj.closeHhd=true});xui.util.Event.on(c,"mouseout",function(){d.obj.closeMmd=true});xui.util.Event.on(a,"mouseout",function(){d.obj.closeSsd=true});xui.util.Event.on(b,"mouseover",function(){d.obj.closeHhd=false});xui.util.Event.on(c,"mouseover",function(){d.obj.closeMmd=false});xui.util.Event.on(a,"mouseover",function(){d.obj.closeSsd=false})},initEventYd:function(){var a=this;xui.util.Event.on($(this.id+"-pre"),"click",function(){a.setYear(true)});xui.util.Event.on($(this.id+"-next"),"click",function(){a.setYear(false)})},initEventMd:function(){var d=this;var c=$(this.id+"-btn-m");xui.util.Event.on(c,"click",function(){$(d.id+"-md").style.display="block"});xui.util.Event.on(c,"mouseout",function(){d.obj.closeMd=true;setTimeout(function(){d.closeMd()},2000)});var b=$(this.id+"-md").getElementsByTagName("a");xui.util.Event.on(b,"click",function(){d.setMonth(this.innerHTML.replace("\u6708",""))});xui.util.Event.on(b,"mouseover",function(){d.obj.closeMd=false});xui.util.Event.on(b,"mouseout",function(){d.obj.closeMd=true})},initEventDd:function(){var b=this;var a=$(this.id+"-db").getElementsByTagName("a");xui.util.Event.on(a,"click",function(){var e=this.className;var d=this.innerHTML.replace(/\s/g,"");if(e.indexOf("xui-dp-a")!=-1){b.setDate(this.innerHTML)}else{var c=b.DATE.getMonth();if(d>20){b.setMonth(c,d)}else{b.setMonth(c+2,d)}}b.select();$(b.id).style.display="none"})},setAttrByArray:function(a){this.DATE=new Date("2000/0/1");if(a[0]){this.DATE.setFullYear(a[0])}else{this.DATE.setFullYear(new Date().getFullYear())}if(a[1]){this.DATE.setMonth(parseInt(a[1],10)-1)}if(a[2]){this.DATE.setDate(a[2])}if(a[3]){this.DATE.setHours(a[3])}if(a[4]){this.DATE.setMinutes(a[4])}if(a[5]){this.DATE.setSeconds(a[5])}},setAttrByObject:function(a){this.DATE=new Date("2000/0/1");if(a.year){this.DATE.setFullYear(a.year)}if(a.month){this.DATE.setMonth(a.month-1)}if(a.date){this.DATE.setDate(a.date)}if(a.hour){this.DATE.setHours(a.hour)}if(a.minute){this.DATE.setMinutes(a.minute)}if(a.second){this.DATE.setSeconds(a.second)}},setAttrByString:function(c){var b=c.split(/[^\d]+/g);this.setAttrByArray(b)},setAttrByNumber:function(a){this.DATE=new Date(a)},closeSsd:function(){if(this.obj.closeSsd){$(this.id+"-s").style.display="none";this.obj.closeSsd=false}else{var a=this;setTimeout(function(){a.closeSsd()},2000)}},closeMmd:function(){if(this.obj.closeMmd){$(this.id+"-m").style.display="none";this.obj.closeMmd=false}else{var a=this;setTimeout(function(){a.closeMmd()},2000)}},closeHhd:function(){if(this.obj.closeHhd){$(this.id+"-h").style.display="none";this.obj.closeHhd=false}else{var a=this;setTimeout(function(){a.closeHhd()},2000)}},closeMd:function(){if(this.obj.closeMd){$(this.id+"-md").style.display="none";this.obj.closeMd=false}else{var a=this;setTimeout(function(){a.closeMd()},2000)}},setSeconds:function(a){this.DATE.setSeconds(a);$(this.id+"-second").innerHTML=a;$(this.id+"-s").style.display="none"},setMinutes:function(a){this.DATE.setMinutes(a);$(this.id+"-minute").innerHTML=a;$(this.id+"-m").style.display="none"},setHours:function(a){this.DATE.setHours(a);$(this.id+"-hour").innerHTML=a;$(this.id+"-h").style.display="none"},setYear:function(a){var b=this.getYear(this.DATE);if(a){b+=1}else{b-=1}this.DATE.setFullYear(b);$(this.id+"-year").innerHTML=b;this.setInnerDay()},setDate:function(a){this.DATE.setDate(a);this.setInnerDay()},setMonth:function(b,c){if(b-1<0){this.setYear(false);b=12-b}else{if(b>12){this.setYear(true);b=b-12}}if(!c){c=this.DATE.getDate()}var a=new Date(new Date(this.getYear(this.DATE),b).getTime()-1).getDate();if(c>a){c=a}this.DATE.setMonth(b-1,a);this.setDate(c);$(this.id+"-month").innerHTML=b+"\u6708";$(this.id+"-md").style.display="none"},getValue:function(){var a=this._getStr();if(this.isDisTime()){return}$(this.id+"-value").innerHTML=a;$(this.id.replace("xui-dp-","")).value=a},_getStr:function(){var b=this.tmpl;var a=this.getYear(this.DATE).toString();a=a.substr(4-this.Tmpls[0].toString().length);b=b.replace(this.Tmpls[0],a);a=this.DATE.getMonth()+1;b=this.getTm(b,a,1);a=this.DATE.getDate();b=this.getTm(b,a,2);a=this.DATE.getHours();b=this.getTm(b,a,3);a=this.DATE.getMinutes();b=this.getTm(b,a,4);a=this.DATE.getSeconds();b=this.getTm(b,a,5);a=this.DATE.getMilliseconds();b=this.getTm(b,a,6);return b},select:function(){this.getValue();var a=this._getStr();if(this.config&&this.config.selectModel=="week"){a=this.getWeek(xui.util.DateUtil.toDate(a))}if(this.obj.selectBefore){this.obj.selectBefore.call(this,a)}},getWeek:function(b){var c=new Date(b).getDay(),e,a;e=new Date(new Date(b).setDate(new Date(b).getDate()-c));a=new Date(new Date(b).setDate(new Date(b).getDate()+(6-c)));return[e,a]},getTm:function(c,b,a){if(this.Tmpls[a].toString().length>0){if(this.Tmpls[a].toString().length>1){if(b<10){b="0"+b}}c=c.replace(this.Tmpls[a],b)}return c},getYear:function(a){return a.getFullYear()},setModel:function(c){var b=false;if(c.tms){if(c.tms=="false"){this.tms=false;$(this.id+"-tms").style.display="none"}else{$(this.id+"-tms").style.display="block";this.tms=true}}if(c.closeModel){if(c.closeModel=="true"){this.obj.closeModel="true";$(this.id+"-close").style.display="none";$(this.id+"-submit").style.display="none";b=true}}if(c.initvalue){$(this.id+"-value").innerHTML=c.initvalue;$(this.id.replace("xui-dp-","")).value=c.initvalue}if(c.clear){$(this.id+"-value").innerHTML="";$(this.id.replace("xui-dp-","")).value=""}if(c.distime){if(c.distime.length&&c.distime.length>0){for(var d=0;d<c.distime.length;d++){this._disTime.push(this.format(c.distime[d]))}b=true}}if(c.selectBefore){this.obj.selectBefore=c.selectBefore}if(b){this.setInnerDay()}if(c.inconver){if(c.inconver=="true"){$(this.id+"-box").style.display="none";var e=this.id.replace("xui-dp-","");$(e).style.display="block";var f=this;xui.util.Event.on(e,"click",function(){if($(f.id).style.display!="block"){f.show($(e))}else{$(f.id).style.display="none"}});this.documentExitId.push(e)}}},isDisTime:function(b){if(!b){b=this.DATE}for(var a=0;a<this._disTime.length;a+=2){if(a+1<this._disTime.length){var c=t2=b;if(!this.tms){c.setMilliseconds(999);c.setSeconds(59);c.setMinutes(59);c.setHours(23);t2.setMilliseconds(0);t2.setSeconds(0);t2.setMinutes(0);t2.setHours(0)}if(this.dateMath(t2,this._disTime[a])&&this.dateMath(this._disTime[a+1],c)){return true}}}return false},dateMath:function(b,a){return b.getTime()>a.getTime()},format:function(b){var a=new xui.widgets.simpleDatePicker();a.setAttr(b);return a.DATE},reset:function(a){this.setAttr(a);this.setInnerYear();this.setInnerMonth();this.setInnerDay();this.setInnerHMS();this.initEvent();this.getValue()}};
