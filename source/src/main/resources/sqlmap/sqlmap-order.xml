<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="order">
	<typeAlias alias="TA_Order" type="com.ssnn.dujiaok.model.order.Order" />

	<resultMap id="RM_Order" class="TA_Order">
		<result column="ID" property="id" />
		<result column="USER_ID" property="userId" />
		<result column="PRODUCT_ID" property="productId" />
		<result column="TOUR_ID" property="tourId" />
		<result column="STATUS" property="status" jdbcType="DECIMAL" />
		<result column="PAY_STATUS" property="payStatus" jdbcType="DECIMAL" />
		<result column="TYPE_ID" property="typeId" />
		<result column="SINGLE_NUMBER" property="singleNumber" />
		<result column="SINGLE_PRICE" property="singlePrice" jdbcType="DECIMAL" />
		<result column="DOUBLE_NUMBER" property="doubleNumber" />
		<result column="DOUBLE_PRICE" property="doublePrice" jdbcType="DECIMAL" />
		<result column="CHILD_NUMBER" property="childNumber" />
		<result column="CHILD_PRICE" property="childPrice" jdbcType="DECIMAL" />
		<result column="COMBO_NUMBER" property="comboNumber" />
		<result column="COMBO_PRICE" property="comboPrice" jdbcType="DECIMAL" />
		<result column="TOTAL_PRICE" property="totalPrice" jdbcType="DECIMAL" />
		<result column="COMMENT" property="comment" jdbcType="VARCHAR" />
		<result column="INSURE" property="insure" />
		<result column="PERSON_INFO" property="personInfo" jdbcType="VARCHAR" />
		<result column="GMT_CREATE" property="gmtCreate" jdbcType="TIMESTAMP" />
		<result column="GMT_MODIFY" property="gmtModify" jdbcType="TIMESTAMP" />
		<result column="ALIPAY_ID" property="alipayId" jdbcType="VARCHAR" />
		<result column="ALIPAY_STATUS" property="alipayStatus"
			jdbcType="VARCHAR" />
		<result column="START_DATE" property="startDate" jdbcType="VARCHAR" />
		<result column="END_DATE" property="endDate" jdbcType="VARCHAR" />
		<result column="ADULT_NUMBER" property="adultNumber" />
		<result column="HOTEL_NUMBER" property="hotelNumber" />
		<result column="HOTEL_PRICE" property="hotelPrice" jdbcType="DECIMAL" />
		<result column="HOTEL_DAY" property="hotelDay" />
	</resultMap>

	<!-- ==================根据用户ID查找订单列表========================================= -->
	<select id="listOrderByUserId" resultMap="RM_Order">
		select ID, USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID, SINGLE_NUMBER,
		SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER, CHILD_PRICE,
		COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE, PERSON_INFO,
		GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS, START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE, HOTEL_DAY
		from trek.ORDER
		where
		USER_ID =
		#userId#
		order by ID desc
	</select>

	<!-- ==================根据订单ID查找订单详情========================================= -->
	<select id="getOrderById" resultMap="RM_Order">
		select ID, USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID, SINGLE_NUMBER,
		SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER, CHILD_PRICE,
		COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE, PERSON_INFO,
		GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS, START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE, HOTEL_DAY
		from
		trek.ORDER
		where
		ID = #id#
	</select>

	<!-- ==================创建订单========================================= -->
	<insert id="addOrder">
		insert into trek.ORDER (USER_ID, PRODUCT_ID, TOUR_ID, STATUS,
			PAY_STATUS, TYPE_ID, SINGLE_NUMBER, SINGLE_PRICE, DOUBLE_NUMBER,
			DOUBLE_PRICE, CHILD_NUMBER, CHILD_PRICE, COMBO_NUMBER, COMBO_PRICE,
			TOTAL_PRICE, COMMENT, INSURE, PERSON_INFO, GMT_CREATE, GMT_MODIFY,
			ALIPAY_ID, ALIPAY_STATUS, START_DATE, END_DATE, ADULT_NUMBER,
			HOTEL_NUMBER, HOTEL_PRICE, HOTEL_DAY)
		values
			(#userId#, #productId#,
			#tourId#,
			#status#, #payStatus#, #typeId#, #singleNumber#,
			#singlePrice#,
			#doubleNumber#,
			#doublePrice#, #childNumber#,
			#childPrice#,
			#comboNumber#,
			#comboPrice#, #totalPrice#, #comment#,
			#insure#,
			#personInfo#, now(),
			now(), #alipayId#, 'init', #startDate#,
			#endDate#, #adultNumber#,
			#hotelNumber#, #hotelNumber#, #hotelDay#)
		<selectKey resultClass="java.lang.Integer" keyProperty="id">
    		<![CDATA[
				SELECT LAST_INSERT_ID() AS ID
			]]>
		</selectKey>
	</insert>

	<!-- ==================修改订单状态========================================= -->
	<update id="updateOrderStatusAndComment">
		<![CDATA[
		update trek.ORDER
		set STATUS = #status#,
		    COMMENT = #comment#,
			GMT_MODIFY = now()
		where ID = #id#
		]]>
	</update>
	
	<!-- ==================酒店修改订单状态========================================= -->
	<update id="updatePayStatusHotel">
		<![CDATA[
		update trek.ORDER
		set STATUS = "等待预定确认",
		    PAY_STATUS = "等待预定确认",
			GMT_MODIFY = now()
		where ID = #id#
		]]>
	</update>
	
	<!-- ==================修改订单状态========================================= -->
	<update id="updateOrderStatus">
		<![CDATA[
		update trek.ORDER
		set STATUS = #status#,
			GMT_MODIFY = now()
		where ID = #id#
		]]>
	</update>

	<!-- ==================支付成功后修改支付宝订单号和状态========================================= -->
	<update id="updateAlipayIdAndStatus">
		<![CDATA[
		update trek.ORDER
		set ALIPAY_ID = #alipayId#,
			ALIPAY_STATUS = #alipayStatus#,
			PAY_STATUS = #payStatus#,
			STATUS = #status#,
			GMT_MODIFY = now()
		where ID = #id#
		]]>
	</update>

	<!-- ==================查询所有订单========================================= -->
	<select id="listAllOrder" resultMap="RM_Order">
		select ID, USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID, SINGLE_NUMBER,
		SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER, CHILD_PRICE,
		COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE, PERSON_INFO,
		GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS, START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE, HOTEL_DAY
		from
		trek.ORDER
		order by ID desc
	</select>


	<!-- ==================根据订单状态查找订单列表========================================= -->
	<select id="listOrderByStatus" resultMap="RM_Order">
		select ID, USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID, SINGLE_NUMBER,
		SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER, CHILD_PRICE,
		COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE, PERSON_INFO,
		GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS, START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE, HOTEL_DAY
		from
		trek.ORDER
		where
		STATUS = #status#
		order by ID desc
	</select>

	<!-- ==================根据订单状态查找订单列表========================================= -->
	<select id="listOrderByPayStatus" resultMap="RM_Order">
		select ID, USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID, SINGLE_NUMBER,
		SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER, CHILD_PRICE,
		COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE, PERSON_INFO,
		GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS, START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE, HOTEL_DAY
		from
		trek.ORDER
		where
		PAY_STATUS = #payStatus#
		order by ID desc
	</select>

	<!-- ==================根据订单状态查找订单列表========================================= -->
	<select id="listOrderByStatusAndPayStatus" resultMap="RM_Order">
		select ID,
		USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID,
		SINGLE_NUMBER, SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER,
		CHILD_PRICE, COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE,
		PERSON_INFO, GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS,
		START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE,
		HOTEL_DAY
		from
		trek.ORDER
		where
		STATUS = #status# AND
		PAY_STATUS =
		#payStatus#
		order by ID desc
	</select>

	<!-- ==================根据用户id和订单状态查找订单列表========================================= -->
	<select id="listOrderByUserIdAndStatus" resultMap="RM_Order">
		select ID,
		USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID,
		SINGLE_NUMBER, SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER,
		CHILD_PRICE, COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE,
		PERSON_INFO, GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS,
		START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE,
		HOTEL_DAY
		from
		trek.ORDER
		where
		USER_ID = #userId# AND STATUS =
		#status#
		order by ID desc
	</select>

	<!-- ==================根据用户id和订单状态查找订单列表========================================= -->
	<select id="listOrderByUserIdAndPayStatus" resultMap="RM_Order">
		select ID,
		USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID,
		SINGLE_NUMBER, SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER,
		CHILD_PRICE, COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE,
		PERSON_INFO, GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS,
		START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE,
		HOTEL_DAY
		from
		trek.ORDER
		where
		USER_ID = #userId# AND PAY_STATUS =
		#payStatus#
		order by ID desc
	</select>

	<select id="listOrderByUserIdAndStatusAndPayStatus" resultMap="RM_Order">
		select ID, USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID,
		SINGLE_NUMBER, SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER,
		CHILD_PRICE, COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE,
		PERSON_INFO, GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS,
		START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE,
		HOTEL_DAY
		from
		trek.ORDER
		where
		USER_ID = #userId# AND STATUS = #status#
		AND PAY_STATUS =
		#payStatus#
		order by ID desc
	</select>

	<select id="listOrderByDate" resultMap="RM_Order">
		select ID, USER_ID,
		PRODUCT_ID, TOUR_ID, STATUS, PAY_STATUS, TYPE_ID, SINGLE_NUMBER,
		SINGLE_PRICE,
		DOUBLE_NUMBER, DOUBLE_PRICE, CHILD_NUMBER, CHILD_PRICE,
		COMBO_NUMBER,
		COMBO_PRICE, TOTAL_PRICE, COMMENT, INSURE, PERSON_INFO,
		GMT_CREATE,
		GMT_MODIFY, ALIPAY_ID, ALIPAY_STATUS, START_DATE, END_DATE,
		ADULT_NUMBER, HOTEL_NUMBER, HOTEL_PRICE, HOTEL_DAY
		from
		trek.ORDER
		where
		GMT_CREATE between #start# and #end#
		order by ID desc
	</select>
</sqlMap>